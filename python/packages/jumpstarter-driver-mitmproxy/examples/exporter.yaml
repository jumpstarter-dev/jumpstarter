# Example Jumpstarter exporter configuration with mitmproxy integration.
#
# Install to: /etc/jumpstarter/exporters/my-bench.yaml
#
# This config exposes:
#   - DUT Link for power control and storage mux
#   - Serial console for shell access
#   - Video capture for screenshot-based assertions
#   - mitmproxy for HTTP(S) interception and backend mocking
#
# Usage:
#   jmp exporter start my-bench
#   jmp shell --exporter my-bench
#
# CLI commands available during a shell session (j proxy <command>):
#   j proxy start [-m mock] [-w]       # start the proxy
#   j proxy stop                        # stop the proxy
#   j proxy restart [-m passthrough]    # restart with new mode
#   j proxy status                      # show proxy status
#   j proxy mock load happy.yaml        # load mock scenario
#   j proxy mock list                   # list configured mocks
#   j proxy mock clear                  # remove all mocks
#   j proxy flow list                   # list recorded flow files
#   j proxy capture list                # show captured requests
#   j proxy capture clear               # clear captured requests
#   j proxy web [--port 9090]           # forward mitmweb UI
#   j proxy cert [output.pem]           # download CA certificate

export:
  # -- Hardware interfaces ---------------------------------------------------

  dutlink:
    type: jumpstarter_driver_dutlink.driver.Dutlink
    config: {}

  serial:
    type: jumpstarter_driver_pyserial.driver.PySerial
    config:
      url: "/dev/serial/by-id/usb-FTDI_debug_console-if00-port0"
      baudrate: 115200

  video:
    type: jumpstarter_driver_ustreamer.driver.UStreamer
    config:
      args:
        device: "/dev/video0"

  # -- Network proxy / mocking -----------------------------------------------

  proxy:
    type: jumpstarter_driver_mitmproxy.driver.MitmproxyDriver
    config:
      # Proxy listener (DUT connects here)
      listen:
        host: "0.0.0.0"
        port: 8080

      # Web UI (mitmweb)
      web:
        host: "0.0.0.0"
        port: 8081

      # Directory layout (subdirs default to {data}/<name>)
      directories:
        data: /opt/jumpstarter/mitmproxy
        conf: /etc/mitmproxy          # override default {data}/conf

      # Skip upstream SSL verification (DUT talks to test infra)
      ssl_insecure: true

      # Auto-load a scenario file on startup (relative to mocks dir)
      # mock_scenario: happy-path.yaml

      # Inline mock definitions (loaded at startup, overlaid on scenario)
      # mocks:
      #   GET /api/v1/health:
      #     status: 200
      #     body: {ok: true}
