{
  "$comment": [
    "jumpstarter-driver-mitmproxy mock configuration v2",
    "This file defines how the proxy responds to requests from the DUT.",
    "Place in your mock_dir (default: /opt/jumpstarter/mitmproxy/mock-responses/)."
  ],

  "config": {
    "files_dir": "/opt/jumpstarter/mitmproxy/mock-files",
    "addons_dir": "/opt/jumpstarter/mitmproxy/addons",
    "default_latency_ms": 0,
    "default_content_type": "application/json"
  },

  "endpoints": {

    "GET /api/v1/status": {
      "status": 200,
      "body": {
        "id": "device-001",
        "status": "active",
        "uptime_s": 86400,
        "battery_pct": 85,
        "firmware_version": "2.5.1",
        "last_updated": "2026-02-13T10:00:00Z"
      }
    },

    "POST /api/v1/command": {
      "status": 200,
      "body": {
        "command_id": "cmd-mock-001",
        "status": "accepted",
        "estimated_completion_s": 15
      },
      "latency_ms": 800,
      "$comment": "Simulate realistic command processing delay"
    },

    "GET /api/v1/search*": {
      "$comment": "Wildcard: matches any path starting with /api/v1/search",
      "status": 200,
      "body": {
        "results": [
          {"name": "Test Location A", "lat": 0.0, "lon": 0.0},
          {"name": "Test Location B", "lat": 0.001, "lon": 0.001}
        ]
      }
    },

    "GET /api/v1/updates/check": {
      "status": 200,
      "body": {
        "update_available": false,
        "current_version": "2.5.1",
        "latest_version": "2.5.1"
      }
    },

    "GET /api/v1/updates/download/v2.6.0.bin": {
      "$comment": "Serve a real binary file from disk",
      "status": 200,
      "file": "firmware/v2.6.0-test.bin",
      "content_type": "application/octet-stream",
      "headers": {
        "Content-Disposition": "attachment; filename=\"v2.6.0.bin\""
      }
    },

    "GET /api/v1/media/album-art*": {
      "$comment": "Serve image files with pattern matching",
      "status": 200,
      "file": "images/default-album-art.jpg",
      "content_type": "image/jpeg"
    },

    "GET /api/v1/config/theme.json": {
      "$comment": "Serve a JSON file directly from disk",
      "status": 200,
      "file": "config/theme.json",
      "content_type": "application/json"
    },

    "POST /api/v1/telemetry/upload": {
      "status": 202,
      "body": {"accepted": true},
      "match": {
        "headers": {
          "Content-Type": "application/json"
        }
      },
      "$comment": "Only matches if Content-Type header is present"
    },

    "POST /api/v1/telemetry/upload#reject": {
      "$comment": "Second rule for same path: missing content type -> 400",
      "status": 400,
      "body": {"error": "Content-Type required"},
      "match": {
        "headers_absent": ["Content-Type"]
      },
      "priority": 10
    },

    "GET /api/v1/weather/current": {
      "status": 200,
      "body_template": {
        "temperature_f": "{{random_int(60, 95)}}",
        "condition": "{{random_choice('sunny', 'cloudy', 'rain', 'snow')}}",
        "humidity_pct": "{{random_int(30, 90)}}",
        "timestamp": "{{now_iso}}"
      },
      "$comment": "Template expressions are evaluated per-request for dynamic data"
    },

    "GET /api/v1/auth/token": {
      "sequence": [
        {
          "status": 200,
          "body": {"token": "mock-token-001", "expires_in": 3600},
          "repeat": 3
        },
        {
          "status": 401,
          "body": {"error": "Token expired"},
          "repeat": 1
        },
        {
          "status": 200,
          "body": {"token": "mock-token-002", "expires_in": 3600}
        }
      ],
      "$comment": "Stateful: first 3 requests succeed, 4th fails, then recovers"
    },

    "GET /streaming/audio/channel/*": {
      "addon": "hls_audio_stream",
      "$comment": "Delegate to a custom addon script for HLS audio simulation"
    },

    "GET /streaming/video/camera/*": {
      "addon": "mjpeg_stream",
      "$comment": "Delegate to a custom addon for MJPEG video streaming"
    },

    "WEBSOCKET /api/v1/data/realtime": {
      "addon": "data_stream_websocket",
      "$comment": "Delegate WebSocket connections to a custom addon"
    }
  }
}
